$scanRoot = "C:\Users\"
$excludePaths = @("C:\Windows\System32", "C:\Windows\SysWOW64", "C:\Program Files*\")
$yaraRule = "C:\Users\david\Desktop\ContiRansomware.yara"

function Excluded($path, $exclusions) {
    foreach ($excl in $exclusions) {
        if ($path -like "$excl*") {
            return $true
        }
    }
    return $false
}
function Show-Alert {
    param (
        [string]$FilePath
    )
    Write-Host "`nALERT: Conti Ransomware Artifact Detected!" -ForegroundColor Red
    Write-Output "File Path: $FilePath"
    Write-Output "=============================================="
}


Get-ChildItem -Path $scanRoot -Recurse -File -ErrorAction SilentlyContinue | Where-Object {
    -not (Excluded $_.FullName $excludePaths)
} | ForEach-Object {
    $filePath = $_.FullName
    $result = yara64.exe -r $yaraRule $filePath
    if ($result) {
		Show-Alert -FilePath $filePath
    }
}
