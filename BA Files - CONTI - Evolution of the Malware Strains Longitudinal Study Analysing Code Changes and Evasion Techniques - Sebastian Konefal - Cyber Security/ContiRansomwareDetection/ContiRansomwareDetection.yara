rule Detected_Conti_Ransomware
{
    meta:
        description = "Detects Conti Ransomware variants"
        author = "David Antonio Martin Escar, Sebastian Konefal & Bogdan Cimpean"
        last_modified = "2025-01-02"
        reference = "BSc. Final Project - Analysis of Conti Ransomware"
		
    strings:
	
		$mal1 = "conti" nocase
		$mal2 = "Conti Module" nocase
		
        $name1 = "Chris Maunder" nocase
        $name2 = "Daniel Lyons" nocase
        
        $email1 = "YPBLAZE@aol.com" nocase
        $email2 = "cmaunder@mail.com" nocase
		$email3 = "flapalinta1950@protonmail.com" nocase
        $email4 = "xersami@protonmail.com" nocase
		$email5 = "rinmayturly1972@protonmail.com" nocase
        
		$ransom1 = "ENCRYPTED BY CONTI" nocase
		$ransom2 = "file encrypted by conti"
		$ransom3 = "CONTIFUN" nocase
		$ransom4 = "CONTI_README.TXT" nocase
		$ransom5 = "readme_for_unlock.txt" nocase
		$ransom6 = "ALL YOUR FILES HAS BEEN ENCRYPTED" nocase
		$ransom7 = "The network is LOCKED" nocase
		$ransom8 = "Do not try to use other software. For decryption KEY write HERE" nocase

		
		$sus_func1 = "vssadmin delete shadows /All /quiet" nocase
		$sus_func2 = "inflate" nocase
		$sus_func3 = "NetShareEnum" nocase
		$sus_func4 = "net stop Antivirus /y" nocase
        
		$func1 = "CreateProcessA" 
        $func2 = "GetProcAddress" 
		$func3 = "CreateMutexA" 
		$func4 = "DeleteCriticalSection" 
		$func5 = "LoadLibrary"
		$func6 = "IsDebuggerPresent" 
		$func7 = "SetUnhandledExceptionFilter" 
		$func8 = "UnhandledExceptionFilter" 
		$func9 = "VirtualAlloc"
		$func10 = "HeapAlloc" 
		$func11 = "GetModuleHandleA" 
		$func12 = "RaiseException" 
		$func13 = "EncodePointer"
		$func14 = "DecodePointer" 

		$dll1 = "MSVCR90.dll" nocase
		$dll2 = "ntdll.dll" nocase
		$dll3 = "Kernel32.dll" nocase
		$dll4 = "User32.dll" nocase
		$dll5 = "COMCTL32.dll" nocase
		$dll6 = "ADVAPI32.dll" nocase
		$dll7 = "Bcrypt.dll" nocase
		$dll8 = "crypt32.dll" nocase
		
        $hex1 = { 45 4E 43 52 59 50 54 45 44 20 42 59 20 43 4F 4E 54 49 }
		
        $prog1 = "RunWinDiff.EXE" nocase
        $prog2 = "RunWinDiff MFC Application" nocase
        $prog3 = "WinDiff UI" nocase
        $prog4 = "RunWinDiff Application" nocase
        $prog5 = "WinDiff Interface" nocase
		
    condition:
		(
			(any of ($mal*)) and (
			(any of ($ransom*)) or
			(any of ($email*)) or
			(any of ($name*)) or
            (any of ($hex*))
			)
		)
		or
        (4 of ($prog*)) or 
		(
		  (2 of ($prog*)) and
		  ((2 of ($func*)) or (2 of ($dll*)) or (2 of ($sus_func*)))
		)
		or
		( (
			(8 of ($func*)) or 
			(5 of ($func*) and 3 of ($dll*)) or 
			(3 of ($func*) and 4 of ($dll*)) or 
			(6 of ($dll*)) or
			(3 of ($sus_func*) and (any of ($func*)) and (any of ($dll*))) or
			(2 of ($sus_func*) and (2 of ($func*)) and (2 of ($dll*)))
		  )
		)
        or
		(
			((any of ($email*)) or (any of ($name*))) 
			and 
			((any of ($mal*)) or (any of ($ransom*)))
		)
}
